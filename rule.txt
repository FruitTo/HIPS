# Snort Rule Structure Note

## 1. Header Fields

Located in the Header struct.
Defines the basic information of the packet to match such as protocol, IP, port, and direction.

|--------------------------------------------------------------------------------|
| Field     | Description                                                        |
| --------- | ------------------------------------------------------------------ |
| action    | Action to take when the rule is triggered, e.g., alert, drop, pass |
| protocal  | Protocol such as tcp, udp, icmp                                    |
| src\_addr | Source IP address, e.g., \$HOME\_NET or any                        |
| src\_port | Source port, e.g., 80, any, \[80,443]                              |
| direction | Direction of traffic: ->, <-, <>                                   |
| dst\_addr | Destination IP address                                             |
| dst\_port | Destination port                                                   |
|--------------------------------------------------------------------------------|

## 2. Rule Body Options

Located in the RuleBody struct. Divided into 5 major categories:

### 2.1 GeneralOptions

General rule information, not used for packet inspection.

|--------------------------------------------------|
| Field     | Description                          |
| --------- | ------------------------------------ |
| msg       | Message to log when rule matches     |
| reference | External references such as cve, url |
| sid       | Rule ID (Snort ID)                   |
| rev       | Rule revision number                 |
| classtype | Threat classification type           |
| priority  | Priority level of the rule           |
| metadata  | Additional metadata information      |
| gid       | Group ID of the rule (default: 1)    |
| service   | Related service, e.g., http          |
|--------------------------------------------------|

### 2.2 PayloadOptions

Used to inspect the packet payload.

|-------------------------------------------------------------------------|
| Field            | Description                                          |
| ---------------- | ---------------------------------------------------- |
| content          | Strings to search for in payload (can have multiple) |
| pcre             | Regular expressions to match payload                 |
| byte\_test       | Test specific bytes in payload                       |
| byte\_jump       | Jump offsets within the payload                      |
| isdataat         | Check if there is data at a specific offset          |
| dsize            | Check payload size                                   |
| offset           | Start offset for content match                       |
| depth            | How deep to search in the payload                    |
| distance         | Distance from previous content match                 |
| within           | Max distance from previous content match             |
| http\_uri        | Inspect URI in HTTP traffic                          |
| http\_header     | Inspect HTTP header fields                           |
| http\_method     | Inspect HTTP method such as GET, POST                |
| http\_cookie     | Inspect HTTP cookie fields                           |
| http\_stat\_code | Inspect HTTP status code like 404, 200               |
| http\_stat\_msg  | Inspect HTTP status message like "Not Found"         |
| http\_raw\_uri   | Inspect raw (non-decoded) HTTP URI                   |
|-------------------------------------------------------------------------|

### 2.3 NonPayloadOptions

Used to inspect protocol headers like TCP/IP or ICMP.

|-------------------------------------------------------|
| Field      | Description                              |
| ---------- | ---------------------------------------- |
| flags      | TCP flags like S, A, R                   |
| fragbits   | IP fragmentation bits                    |
| fragoffset | Offset of IP fragment                    |
| ttl        | Time to Live value                       |
| tos        | Type of Service field                    |
| id         | IP identification number                 |
| ipopts     | IP header options field                  |
| seq        | TCP sequence number                      |
| ack        | TCP acknowledgment number                |
| icmp\_id   | ICMP ID field                            |
| icmp\_seq  | ICMP sequence number                     |
| itype      | ICMP type value                          |
| icode      | ICMP code value                          |
| ip\_proto  | IP protocol number (TCP=6, UDP=17, etc.) |
|-------------------------------------------------------|

### 2.4 PostDetectionOptions

Used for state tracking or post-match control.

|-------------------------------------------------------------------|
| Field             | Description                                   |
| ----------------- | --------------------------------------------- |
| flow              | Direction of flow, e.g., to\_client           |
| flowbits          | Variable used for tracking state across rules |
| detection\_filter | Rate-based detection condition                |
| threshold         | Control duplicate alert rate                  |
| tag               | Log extra packets after match                 |
|-------------------------------------------------------------------|

### 2.5 AppLayerOptions

Used to inspect application layer protocols such as SIP, SSL, DCE-RPC.

|----------------------------------------------------|
| Field           | Description                      |
| --------------- | -------------------------------- |
| sip\_method     | SIP method like INVITE, REGISTER |
| sip\_stat\_code | SIP status code                  |
| ssl\_state      | State of SSL handshake           |
| ssl\_version    | SSL version (e.g., TLS 1.2)      |
| dce\_iface      | DCE/RPC interface UUID           |
| dce\_opnum      | DCE/RPC operation number         |
| dce\_stub\_data | DCE/RPC stub data content        |
|----------------------------------------------------|
